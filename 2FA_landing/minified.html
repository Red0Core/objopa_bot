<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>OBJOPA 2FA</title><style>:root { color-scheme: dark; --bg: radial-gradient(circle at 20% 20%, #0c1024, #050712 60%, #02030a 100%); --card: rgba(255, 255, 255, 0.06); --stroke: rgba(255, 255, 255, 0.14); --muted: #94a3b8; --text: #e2e8f0; --accent: #a855f7; --accent-2: #22d3ee; --green: #34d399; font-family: "Inter", "SF Pro Text", system-ui, -apple-system, sans-serif; } * { box-sizing: border-box; } body { margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: max(14px, env(safe-area-inset-left)); padding-right: max(14px, env(safe-area-inset-right)); background: var(--bg); color: var(--text); } .page { width: min(420px, 100%); background: var(--card); border: 1px solid var(--stroke); border-radius: 18px; padding: clamp(14px, 4vw, 20px); box-shadow: 0 14px 45px rgba(0, 0, 0, 0.55); backdrop-filter: blur(12px); display: grid; gap: 14px; } header { display: flex; align-items: center; justify-content: space-between; gap: 10px; } h1 { margin: 0; font-size: clamp(17px, 4vw, 19px); letter-spacing: 0.08em; } .pill { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 6px 12px; border-radius: 999px; border: 1px solid var(--stroke); background: rgba(255, 255, 255, 0.05); font-size: 12px; letter-spacing: 0.06em; } .otp-button { width: 100%; border: 1px solid var(--stroke); background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(34, 211, 238, 0.08)); border-radius: 12px; padding: 12px; color: inherit; display: grid; gap: 8px; cursor: pointer; transition: transform 120ms ease, border-color 150ms ease; } .otp-button:active { transform: scale(0.98); } .otp-digits { display: flex; justify-content: center; gap: 8px; font-weight: 700; font-size: clamp(28px, 10vw, 38px); letter-spacing: 0.12em; } .otp-box { min-width: clamp(36px, 8vw, 44px); display: flex; align-items: center; justify-content: center; padding: 8px 0; border-radius: 12px; background: rgba(255, 255, 255, 0.06); border: 1px solid transparent; transition: transform 160ms ease, background 160ms ease, border-color 160ms ease, box-shadow 160ms ease; } @keyframes copiedPulse { 0% { transform: translateY(0) scale(1); } 35% { transform: translateY(-2px) scale(1.02); } 100% { transform: translateY(0) scale(1); } } .otp-button.copied .otp-box { border-color: var(--green); box-shadow: 0 0 0 1px rgba(52, 211, 153, 0.28); background: linear-gradient(135deg, rgba(52, 211, 153, 0.15), rgba(168, 85, 247, 0.08)); animation: copiedPulse 420ms ease; } .inline { display: flex; align-items: center; justify-content: space-between; gap: 8px; font-size: 12px; color: var(--muted); } .progress { width: 100%; height: 4px; border-radius: 999px; background: rgba(255, 255, 255, 0.06); overflow: hidden; } .progress span { display: block; height: 100%; width: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); transform-origin: left; transition: width 300ms linear; } input { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--stroke); background: rgba(255, 255, 255, 0.02); color: inherit; font-size: 14px; } input:focus { outline: 1px solid var(--accent); border-color: var(--accent); } button.ghost { width: 100%; border: 1px dashed var(--stroke); background: transparent; color: var(--text); padding: 10px 12px; border-radius: 10px; cursor: pointer; transition: border-color 120ms ease; font-size: 14px; } button.ghost:active { border-color: var(--accent); } .meta { font-size: 12px; color: var(--muted); } @media (max-width: 380px) { .otp-digits { gap: 6px; letter-spacing: 0.1em; } .otp-box { min-width: 34px; } }</style></head><body><div class="page"> <header> <h1>OBJOPA</h1> <span class="pill"> <span style="width: 6px; height: 6px; border-radius: 50%; background: var(--accent);"></span> 2FA </span> </header> <button class="otp-button" id="otp" type="button" aria-label="Скопировать код"> <div class="inline"> <span>OTP</span> <span id="remaining">30s</span> </div> <div class="otp-digits"></div> <div class="progress" aria-hidden="true"> <span id="timer-fill"></span> </div> </button> <input id="secret" inputmode="text" autocomplete="one-time-code" placeholder="SECRET · BASE32" aria-label="Секрет в Base32" /> <div class="inline" style="gap: 10px;"> <button class="ghost" id="sync-btn" type="button" style="max-width: 120px;">Время</button> <div class="meta" id="drift" aria-live="polite">—</div> </div> </div> <script>function resetSecret(){cryptoKey=null,secretBytes=null,lastSecret=""}function padStart(t,e,n){for(var r=String(t);r.length<e;)r=n+r;return r}function extractSecretFromUrl(){var t=initialPathSecret.trim();if(t)return t.replace(/\s+/g,"");var e=new URLSearchParams(window.location.search),n=e.get("otpauth");if(!n)return null;try{var r=new URL(n),a=r.searchParams.get("secret");return a?a.replace(/\s+/g,""):null}catch(t){return null}}function base32ToBytes(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",n=t.replace(/\s+/g,""),r="",a=0;a<n.length;a++){var i=n.charAt(a),o=e.indexOf(i);if(-1!==o){for(var c=o.toString(2);c.length<5;)c="0"+c;r+=c}}for(var s=[],l=0;l+8<=r.length;l+=8)s.push(parseInt(r.slice(l,l+8),2));return new Uint8Array(s)}function prepareKey(t){return new Promise(function(e){if(!t)return resetSecret(),e();var n=base32ToBytes(t);return n.length?(secretBytes=n,lastSecret=t,crypto&&crypto.subtle&&crypto.subtle.importKey?void crypto.subtle.importKey("raw",n,{name:"HMAC",hash:"SHA-1"},!1,["sign"]).then(function(t){cryptoKey=t,e()}).catch(function(){cryptoKey=null,e()}):(cryptoKey=null,e())):(resetSecret(),e())})}function leftRotate(t,e){return(t<<e|t>>>32-e)>>>0}function sha1(t){for(var e=[],n=8*t.length,r=0;r<t.length;r++)e[r>>2]|=t[r]<<24-r%4*8;e[n>>5]|=128<<24-n%32,e[15+(n+64>>9<<4)]=n;for(var a=1732584193,i=4023233417,o=2562383102,c=271733878,s=3285377520,r=0;r<e.length;r+=16){for(var l=e.slice(r,r+16),p=16;p<80;p++)l[p]=leftRotate((l[p-3]^l[p-8]^l[p-14]^l[p-16])>>>0,1);for(var u=a,h=i,f=o,g=c,d=s,p=0;p<80;p++){var y=0,m=0;p<20?(y=h&f|~h&g,m=1518500249):p<40?(y=h^f^g,m=1859775393):p<60?(y=h&f|h&g|f&g,m=2400959708):(y=h^f^g,m=3395469782);var v=leftRotate(u,5)+y+d+m+(l[p]>>>0)>>>0;d=g,g=f,f=leftRotate(h,30),h=u,u=v}a=a+u>>>0,i=i+h>>>0,o=o+f>>>0,c=c+g>>>0,s=s+d>>>0}for(var S=new Uint8Array(20),w=[a,i,o,c,s],r=0;r<w.length;r++)S[4*r]=w[r]>>>24&255,S[4*r+1]=w[r]>>>16&255,S[4*r+2]=w[r]>>>8&255,S[4*r+3]=255&w[r];return S}function hmacSha1(t,e){var n=t;n.length>64&&(n=sha1(n));var r=new Uint8Array(64);r.set(n);for(var a=new Uint8Array(64),i=new Uint8Array(64),o=0;o<64;o++)a[o]=92^r[o],i[o]=54^r[o];var c=new Uint8Array(64+e.length);c.set(i,0),c.set(e,64);var s=sha1(c),l=new Uint8Array(64+s.length);return l.set(a,0),l.set(s,64),sha1(l)}function updateUrlWithSecret(t){var e=new URL(window.location.href),n=basePathSegments.slice();t&&n.push(encodeURIComponent(t)),e.pathname="/"+n.join("/"),window.history.replaceState({},"",e)}function generateOtp(t){return new Promise(function(e){function n(t){if(!t)return e(null);var n=15&t[t.length-1],r=(127&t[n])<<24|(255&t[n+1])<<16|(255&t[n+2])<<8|255&t[n+3];e(padStart((r%1e6).toString(),6,"0"))}if(!cryptoKey&&!secretBytes)return e(null);var r=Math.floor(t/30),a=new ArrayBuffer(8);new DataView(a).setUint32(4,r,!1),cryptoKey?crypto.subtle.sign("HMAC",cryptoKey,a).then(function(t){n(new Uint8Array(t))}).catch(function(){e(null)}):secretBytes&&n(hmacSha1(secretBytes,new Uint8Array(a)))})}function renderOtp(t){var e=padStart(t,6,"-").slice(0,6).split(""),n=e.map(function(t){return'<span class="otp-box">'+t+"</span>"}).join("");otpDigits.innerHTML=n}function update(){if(!isUpdating){isUpdating=!0;var t=Math.floor(Date.now()/1e3);lastLocalUnix=t;var e=30-t%30;if(remainingTag.textContent=e+"s",timerFill.style.width=e/30*100+"%",!cryptoKey&&!secretBytes)return renderOtp("------"),void(isUpdating=!1);generateOtp(t).then(function(t){renderOtp(t||"------"),isUpdating=!1}).catch(function(){renderOtp("------"),isUpdating=!1})}}function copyOtp(){var t=otpDigits.textContent.replace(/\s+/g,"");t&&-1===t.indexOf("-")&&navigator.clipboard.writeText(t).catch(function(){}).then(function(){otpTag.classList.add("copied"),setTimeout(function(){otpTag.classList.remove("copied")},640)})}function fetchNetworkTime(){syncBtn.disabled=!0,syncBtn.textContent="...",fetch("https://worldtimeapi.org/api/ip",{cache:"no-store"}).then(function(t){if(!t.ok)throw new Error("HTTP "+t.status);return t.json()}).then(function(t){var e=Math.floor(t.unixtime),n=lastLocalUnix||Math.floor(Date.now()/1e3),r=n-e,a=r>0?"+"+r:String(r);driftTag.textContent=a+" сек"}).catch(function(){driftTag.textContent="—"}).finally(function(){syncBtn.disabled=!1,syncBtn.textContent="Время"})}var otpTag=document.getElementById("otp"),otpDigits=otpTag.querySelector(".otp-digits"),remainingTag=document.getElementById("remaining"),timerFill=document.getElementById("timer-fill"),secretInput=document.getElementById("secret"),syncBtn=document.getElementById("sync-btn"),driftTag=document.getElementById("drift"),pathSegments=window.location.pathname.split("/").filter(Boolean),lastSegment=pathSegments.length?pathSegments[pathSegments.length-1]:"",hasExtension=-1!==lastSegment.indexOf("."),initialPathSecret=pathSegments.length&&!hasExtension?decodeURIComponent(lastSegment):"",basePathSegments=initialPathSecret?pathSegments.slice(0,-1):pathSegments.slice(),cryptoKey=null,secretBytes=null,isUpdating=!1,lastLocalUnix=null,lastSecret="";otpTag.addEventListener("click",copyOtp),secretInput.addEventListener("input",function(t){var e=t.target.value.replace(/[^a-zA-Z2-7\s]/g,"").toUpperCase();t.target.value=e,updateUrlWithSecret(e),e!==lastSecret&&prepareKey(e).then(update)}),syncBtn.addEventListener("click",fetchNetworkTime);var initialSecret=extractSecretFromUrl();if(initialSecret){var normalized=initialSecret.toUpperCase();secretInput.value=normalized,updateUrlWithSecret(normalized),prepareKey(normalized).then(update)}setInterval(update,1e3),renderOtp("------"),update();
</script></body></html>