<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>OBJOPA 2FA</title><style>    :root {      color-scheme: dark;      --bg: radial-gradient(circle at 20% 20%, #0c1024, #050712 60%, #02030a 100%);      --card: rgba(255, 255, 255, 0.06);      --stroke: rgba(255, 255, 255, 0.14);      --muted: #94a3b8;      --text: #e2e8f0;      --accent: #a855f7;      --accent-2: #22d3ee;      --green: #34d399;      font-family: "Inter", "SF Pro Text", system-ui, -apple-system, sans-serif;    }    * {      box-sizing: border-box;    }    body {      margin: 0;      min-height: 100vh;      display: flex;      align-items: center;      justify-content: center;      padding: max(14px, env(safe-area-inset-left));      padding-right: max(14px, env(safe-area-inset-right));      background: var(--bg);      color: var(--text);    }    .page {      width: min(420px, 100%);      background: var(--card);      border: 1px solid var(--stroke);      border-radius: 18px;      padding: clamp(14px, 4vw, 20px);      box-shadow: 0 14px 45px rgba(0, 0, 0, 0.55);      backdrop-filter: blur(12px);      display: grid;      gap: 14px;    }    header {      display: flex;      align-items: center;      justify-content: space-between;      gap: 10px;    }    h1 {      margin: 0;      font-size: clamp(18px, 5vw, 20px);      letter-spacing: 0.02em;    }    .pill {      padding: 6px 10px;      border-radius: 999px;      border: 1px solid var(--stroke);      background: rgba(255, 255, 255, 0.05);      font-size: 12px;      letter-spacing: 0.06em;    }    .card {      border: 1px solid var(--stroke);      border-radius: 14px;      padding: 12px;      background: rgba(255, 255, 255, 0.03);      display: grid;      gap: 10px;    }    .otp-button {      width: 100%;      border: 1px solid var(--stroke);      background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(34, 211, 238, 0.08));      border-radius: 12px;      padding: 12px;      color: inherit;      display: grid;      gap: 6px;      cursor: pointer;      transition: transform 120ms ease, border-color 150ms ease;    }    .otp-button:active {      transform: scale(0.98);    }    .otp-digits {      display: flex;      justify-content: center;      gap: 6px;      font-weight: 700;      font-size: clamp(26px, 9vw, 36px);      letter-spacing: 0.08em;    }    .otp-box {      min-width: 34px;      text-align: center;      padding: 6px 0;      border-radius: 10px;      background: rgba(255, 255, 255, 0.06);      border: 1px solid transparent;    }    .otp-button.copied .otp-box {      border-color: var(--green);      box-shadow: 0 0 0 1px rgba(52, 211, 153, 0.3);    }    .inline {      display: flex;      align-items: center;      justify-content: space-between;      gap: 8px;      font-size: 13px;      color: var(--muted);    }    .progress {      width: 100%;      height: 4px;      border-radius: 999px;      background: rgba(255, 255, 255, 0.06);      overflow: hidden;    }    .progress span {      display: block;      height: 100%;      width: 100%;      background: linear-gradient(90deg, var(--accent), var(--accent-2));      transform-origin: left;      transition: width 300ms linear;    }    .field {      display: grid;      gap: 6px;    }    label {      font-size: 12px;      color: var(--muted);      letter-spacing: 0.02em;    }    input {      width: 100%;      padding: 10px 12px;      border-radius: 10px;      border: 1px solid var(--stroke);      background: rgba(255, 255, 255, 0.02);      color: inherit;      font-size: 14px;    }    input:focus {      outline: 1px solid var(--accent);      border-color: var(--accent);    }    button.ghost {      width: 100%;      border: 1px dashed var(--stroke);      background: transparent;      color: var(--text);      padding: 10px 12px;      border-radius: 10px;      cursor: pointer;      transition: border-color 120ms ease;      font-size: 14px;    }    button.ghost:active {      border-color: var(--accent);    }    .meta {      display: grid;      gap: 6px;      font-size: 12px;      color: var(--muted);    }    .meta-row {      display: flex;      justify-content: space-between;      align-items: center;      gap: 8px;    }    .copy-toast {      justify-self: center;      min-width: 160px;      padding: 8px 12px;      border-radius: 12px;      border: 1px solid var(--stroke);      background: rgba(52, 211, 153, 0.08);      color: var(--green);      font-weight: 600;      font-size: 13px;      text-align: center;      opacity: 0;      transform: translateY(6px);      transition: opacity 180ms ease, transform 180ms ease;    }    .copy-toast.show {      opacity: 1;      transform: translateY(0);    }    @media (max-width: 380px) {      .otp-box {        min-width: 30px;      }      .meta-row {        flex-direction: column;        align-items: flex-start;      }    }  </style></head><body><div class="page"><header><div><h1>OBJOPA 2FA</h1><p class="inline" style="margin: 4px 0 0; color: var(--muted);">          Минимальный генератор OTP        </p></div><span class="pill">MINI</span></header><div class="card" aria-live="polite"><button class="otp-button" id="otp" type="button" aria-label="Скопировать код"><div class="inline"><span>Ваш код</span><span id="remaining">30s</span></div><div class="otp-digits"></div><div class="progress" aria-hidden="true"><span id="timer-fill"></span></div></button><p class="inline" style="margin: 0; font-size: 12px;">        Коснитесь кода, чтобы скопировать в буфер обмена.      </p><div class="copy-toast" role="status">Код скопирован</div></div><div class="card"><div class="field"><label for="secret">Секрет в Base32</label><input id="secret" inputmode="text" autocomplete="one-time-code" placeholder="JBSWY3DPEHPK3PXP" /></div><button class="ghost" id="sync-btn" type="button">Сравнить время</button><div class="meta" id="sync-hint">Синхронизация по сети не выполнялась.</div><div class="meta"><div class="meta-row"><span>Локальный UNIX</span><strong id="unix-local">—</strong></div><div class="meta-row"><span>Сетевой UNIX</span><strong id="unix-network">—</strong></div><div class="meta-row"><span>Разница</span><strong id="drift">—</strong></div></div></div></div><script>    const otpTag = document.getElementById("otp");    const otpDigits = otpTag.querySelector(".otp-digits");    const remainingTag = document.getElementById("remaining");    const timerFill = document.getElementById("timer-fill");    const unixTag = document.getElementById("unix-local");    const unixGlobalTag = document.getElementById("unix-network");    const driftTag = document.getElementById("drift");    const secretInput = document.getElementById("secret");    const syncBtn = document.getElementById("sync-btn");    const syncHint = document.getElementById("sync-hint");    const toast = document.querySelector(".copy-toast");    let cryptoKey = null;    let isUpdating = false;    let lastLocalUnix = null;    let lastSecret = "";    function extractSecretFromUrl() {      const params = new URLSearchParams(window.location.search);      const otpauth = params.get("otpauth");      if (!otpauth) return null;      try {        const url = new URL(otpauth);        const secret = url.searchParams.get("secret");        return secret?.replace(/\s+/g, "") ?? null;      } catch (error) {        return null;      }    }    function base32ToBytes(base32String) {      const base32Alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";      const cleaned = base32String.replace(/\s+/g, "");      let bits = "";      for (const char of cleaned) {        const value = base32Alphabet.indexOf(char);        if (value === -1) continue;        bits += value.toString(2).padStart(5, "0");      }      const bytes = [];      for (let i = 0; i + 8 <= bits.length; i += 8) {        bytes.push(parseInt(bits.slice(i, i + 8), 2));      }      return new Uint8Array(bytes);    }    async function prepareKey(secret) {      if (!secret) {        cryptoKey = null;        lastSecret = "";        return;      }      try {        const bytes = base32ToBytes(secret);        if (!bytes.length) throw new Error("empty");        cryptoKey = await crypto.subtle.importKey(          "raw",          bytes,          { name: "HMAC", hash: "SHA-1" },          false,          ["sign"]        );        lastSecret = secret;      } catch (error) {        cryptoKey = null;        lastSecret = "";      }    }    async function generateOtp(unixTime) {      if (!cryptoKey) return null;      const counter = Math.floor(unixTime / 30);      const buffer = new ArrayBuffer(8);      const view = new DataView(buffer);      view.setUint32(4, counter, false);      const signature = await crypto.subtle.sign("HMAC", cryptoKey, buffer);      const hash = new Uint8Array(signature);      const offset = hash[hash.length - 1] & 0x0f;      const binary =        ((hash[offset] & 0x7f) << 24) |        ((hash[offset + 1] & 0xff) << 16) |        ((hash[offset + 2] & 0xff) << 8) |        (hash[offset + 3] & 0xff);      return (binary % 1_000_000).toString().padStart(6, "0");    }    function renderOtp(value) {      const digits = value.padStart(6, "-").slice(0, 6).split("");      otpDigits.innerHTML = digits        .map((digit) => `<span class="otp-box">${digit}</span>`)        .join("");    }    async function update() {      if (isUpdating) return;      isUpdating = true;      const unixTime = Math.floor(Date.now() / 1000);      lastLocalUnix = unixTime;      unixTag.textContent = unixTime;      const secondsLeft = 30 - (unixTime % 30);      remainingTag.textContent = `${secondsLeft}s`;      timerFill.style.width = `${(secondsLeft / 30) * 100}%`;      if (!cryptoKey) {        renderOtp("------");        isUpdating = false;        return;      }      try {        const otp = await generateOtp(unixTime);        renderOtp(otp ?? "------");      } catch (error) {        renderOtp("------");      } finally {        isUpdating = false;      }    }    async function copyOtp() {      const value = otpDigits.textContent.replace(/\s+/g, "");      if (!value || value.includes("-")) return;      try {        await navigator.clipboard.writeText(value);        toast.classList.add("show");        otpTag.classList.add("copied");        setTimeout(() => toast.classList.remove("show"), 1200);        setTimeout(() => otpTag.classList.remove("copied"), 600);      } catch (error) {        toast.textContent = "Не удалось скопировать";        toast.classList.add("show");        setTimeout(() => toast.classList.remove("show"), 1400);      }    }    async function fetchNetworkTime() {      syncBtn.disabled = true;      syncBtn.textContent = "Запрос...";      syncHint.textContent = "Получаем время из сети";      try {        const response = await fetch("https://worldtimeapi.org/api/ip", { cache: "no-store" });        if (!response.ok) throw new Error(`HTTP ${response.status}`);        const data = await response.json();        const networkUnix = Math.floor(data.unixtime);        unixGlobalTag.textContent = networkUnix;        const currentLocal = lastLocalUnix ?? Math.floor(Date.now() / 1000);        const drift = currentLocal - networkUnix;        const signed = drift > 0 ? `+${drift}` : `${drift}`;        driftTag.textContent = `${signed} сек`;        syncHint.textContent = "Сравнение завершено";      } catch (error) {        syncHint.textContent = "Не удалось получить сетевое время";        driftTag.textContent = "—";        unixGlobalTag.textContent = "—";      } finally {        syncBtn.disabled = false;        syncBtn.textContent = "Сравнить время";      }    }    otpTag.addEventListener("click", copyOtp);    secretInput.addEventListener("input", (event) => {      const value = event.target.value.replace(/[^a-zA-Z2-7\s]/g, "").toUpperCase();      event.target.value = value;      if (value === lastSecret) return;      prepareKey(value).then(update);    });    syncBtn.addEventListener("click", fetchNetworkTime);    const initialSecret = extractSecretFromUrl();    if (initialSecret) {      secretInput.value = initialSecret;      prepareKey(initialSecret).then(update);    }    setInterval(update, 1000);    renderOtp("------");    update();  </script></body></html>